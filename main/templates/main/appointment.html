{% extends 'base.html' %}

{% block title %}Запис{% endblock %}

{% block content %}
<form method="post" action="{% url 'appointment' %}" class="form-control">
    {% csrf_token %}
    {{ form.as_p }}
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            function updateAvailableSlots() {
                var selectedDate = $('#id_date').val(); 
                var selectedService = $('#id_service').val(); 

                if (selectedDate && selectedService) {
                    $.ajax({
                        url: '{% url "get_available_slots" %}',
                        data: {
                            'date': selectedDate,
                            'service_id': selectedService
                        },
                        dataType: 'json',
                        success: function(data) {
                            $('#id_time').empty();
                            $.each(data.slots, function(index, slot) {
                                $('#id_time').append($('<option>', {
                                    value: slot,
                                    text: slot
                                }));
                            });
                        },
                        error: function() {
                            $('#id_time').empty();
                            $('#id_time').append($('<option>', {
                                text: 'Не вдалося завантажити слоти',
                                disabled: true
                            }));
                        }
                    });
                }
            }

            $('#id_date').change(updateAvailableSlots);
            $('#id_service').change(updateAvailableSlots);

            $('#id_date').val('');
            $('#id_time').empty();
        });
    </script>
    
    <button type="submit" class="btn btn-primary">Записатись</button>
</form>
{% endblock %}
