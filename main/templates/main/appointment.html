{% extends 'base.html' %}

{% block title %} Запис {% endblock %}

{% block content %}
<!-- Підключаємо jQuery через CDN -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<form method="post" action="{% url 'appointment' %}">
    {% csrf_token %}
    {{ form.as_p }}
    
    <script>
        $(document).ready(function() {
            // Відслідковуємо зміну дати
            $('#id_date').change(function() {
                var selectedDate = $(this).val(); // Отримуємо вибрану дату
                
                // Виконуємо AJAX-запит на сервер для отримання доступних слотів
                $.ajax({
                    url: '{% url "get_available_slots" %}',  // Викликаємо наше представлення
                    data: {
                        'date': selectedDate  // Передаємо обрану дату в запиті
                    },
                    dataType: 'json',
                    success: function(data) {
                        // Очищаємо список слотів
                        $('#id_time').empty();
                        
                        // Додаємо нові доступні слоти до поля time
                        $.each(data.slots, function(index, slot) {
                            $('#id_time').append($('<option>', {
                                value: slot,
                                text: slot
                            }));
                        });
                    }
                });
            });
        });
    </script>
    
    <button type="submit">Записатись</button>
</form>
{% endblock %}
