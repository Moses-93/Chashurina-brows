{% extends 'base.html' %}

{% block title %}Запис{% endblock %}

{% block content %}
<!-- Підключаємо jQuery через CDN -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<form method="post" action="{% url 'appointment' %}">
    {% csrf_token %}
    {{ form.as_p }}
    
    <script>
        $(document).ready(function() {
            function updateAvailableSlots() {
                var selectedDate = $('#id_date').val(); // Отримуємо вибрану дату
                var selectedService = $('#id_service').val(); // Отримуємо обрану послугу

                // Перевіряємо, що дата та послуга вибрані
                if (selectedDate && selectedService) {
                    // Виконуємо AJAX-запит на сервер для отримання доступних слотів
                    $.ajax({
                        url: '{% url "get_available_slots" %}',
                        data: {
                            'date': selectedDate,
                            'service_id': selectedService  // Передаємо обрану дату та послугу в запиті
                        },
                        dataType: 'json',
                        success: function(data) {
                            // Очищаємо список слотів
                            $('#id_time').empty();

                            // Додаємо нові доступні слоти до поля time
                            $.each(data.slots, function(index, slot) {
                                $('#id_time').append($('<option>', {
                                    value: slot,
                                    text: slot
                                }));
                            });
                        },
                        error: function() {
                            // Відображаємо повідомлення у разі помилки
                            $('#id_time').empty();
                            $('#id_time').append($('<option>', {
                                text: 'Не вдалося завантажити слоти',
                                disabled: true
                            }));
                        }
                    });
                }
            }

            // Відслідковуємо зміну дати та послуги
            $('#id_date').change(updateAvailableSlots);
            $('#id_service').change(updateAvailableSlots);

            // Встановлюємо порожній варіант при завантаженні сторінки
            $('#id_date').val('');  // Скидаємо дату на порожню
            $('#id_time').empty();  // Очищаємо слоти часу
        });
    </script>
    
    <button type="submit">Записатись</button>
</form>
{% endblock %}
